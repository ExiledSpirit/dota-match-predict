<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap");

      * {
        box-sizing: border-box;
      }

      body {
        max-width: 960px;
        width: 100%;
        margin: 0 auto;
        font-family: "Inter", sans-serif;
        font-size: 0.8rem;
      }

      button {
        font-family: inherit;
      }

      table {
        table-layout: fixed;
        width: 100%;
      }

      td,
      th {
        padding: 0.2rem;
      }

      tr {
        height: 2rem;
      }
      tr:hover {
        background: #f8f8f8;
      }

      .model-col,
      .result-col {
        width: 3rem;
        overflow: hidden;
        font-size: 0.8rem;
        font-style: italic;
        text-align: center;
      }

      .result-col {
        width: 5rem;
      }

      .label-0 {
        background: #dddddd;
      }
      .label-1 {
        background: #ffdddd;
      }

      .prompt-col {
        text-align: left;
      }

      .controls {
        margin: 2rem 0;
        display: flex;
        gap: 1rem;
        height: 10rem;
      }

      .form {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        flex-grow: 1;
        flex-shrink: 1;
      }

      #prompt {
        resize: none;
        flex-grow: 1;
        padding: 1rem;
        font-family: inherit;
      }

      .form-actions {
        display: flex;
        align-items: stretch;
        justify-content: end;
        gap: 0.25rem;
      }

      #classify {
        padding: 0.25rem 2rem;
      }

      .embedding-wrapper {
        width: 13rem;
        border: 1px solid #aaa;
        overflow-y: auto;
        padding: 1rem;
      }

      #embedding {
        white-space: pre;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Classifier Test</h1>
      <div class="controls">
        <section class="form">
          <textarea id="prompt"></textarea>
          <div class="form-actions">
            <button id="clear-results">Clear results</button>
            <span style="flex-grow: 1; flex-shrink: 1"></span>
            <button id="default-suite">Run default test suite</button>
            <button id="classify">Classify</button>
          </div>
        </section>
        <div class="embedding-wrapper">
          <code id="embedding"></code>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th class="prompt-col">Prompt</th>
            <th class="model-col" title="SVM">SVM</th>
            <th class="model-col" title="Gradient Boosting">
              Gradient Boosting
            </th>
            <th class="model-col" title="Neural Network">Neural Network</th>
            <th class="model-col" title="Logistic Regression">
              Logistic Regression
            </th>
            <th class="model-col" title="Random Forest">Random Forest</th>
            <th class="model-col" title="Decision Tree">Decision Tree</th>
            <th class="model-col" title="KNN">KNN</th>
            <th class="result-col">MÃ©dia</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              Eos dolore sint eos consectetur sit. Nulla repudiandae ex
              recusandae. Iste pariatur ex omnis eum omnis corporis repellat.
              Earum soluta non expedita. Eum odit quos amet ea reprehenderit
              quisquam non.
            </td>
            <td class="model-col">0</td>
            <td class="model-col">0</td>
            <td class="model-col">0</td>
            <td class="model-col">0</td>
            <td class="model-col">0</td>
            <td class="model-col">0</td>
            <td class="model-col">0</td>
            <td class="result-col">0</td>
          </tr>
        </tbody>
      </table>
    </main>
    <script>
      const table = document.querySelector("table");
      const classifyBtn = document.querySelector("#classify");
      const clearResultsBtn = document.querySelector("#clear-results");
      const defaultSuiteBtn = document.querySelector("#default-suite");
      const promptTextarea = document.querySelector("#prompt");
      const embeddingArea = document.querySelector("#embedding");

      async function classify(prompt) {
        const result = await fetch("http://localhost:8000/classify", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ prompt }),
        });

        const body = await result.json();

        embeddingArea.innerText = body.embedding
          .map(
            (value, index) =>
              `d${index.toString().padEnd(3)} : ${value
                .toString()
                .padStart(14, " ")}`
          )
          .join("\n");

        const row = table.tBodies[0].insertRow(0);

        const pCell = row.insertCell();
        pCell.classList.add("prompt-col");
        pCell.innerText = prompt;
        const resultAcc = {};
        for (const [classifier, result] of Object.entries(body.result)) {
          const cCell = row.insertCell();
          cCell.classList.add("model-col", `label-${result}`);
          cCell.innerText = result;

          if (!resultAcc[result]) resultAcc[result] = 0;
          resultAcc[result]++;
        }

        const overall =
          (resultAcc["0"] ?? 0) > (resultAcc["1"] ?? 0) ? "0" : "1";
        const mCell = row.insertCell();
        mCell.classList.add("result-col", `label-${overall}`);
        mCell.innerText = overall;

        return body;
      }

      classifyBtn.addEventListener("click", () => {
        const prompt = promptTextarea.value;
        if (!prompt) return;
        classify(prompt);
      });

      clearResultsBtn.addEventListener("click", () => {
        [...table.querySelectorAll("tbody tr")].forEach((row) => row.remove());
        embeddingArea.innerText = "";
      });

      defaultSuiteBtn.addEventListener("click", async () => {
        const tests = [];

        for (const group of [
          "brazilian",
          "argentinian",
          "american",
          "iranian",
          "european",
          "italian",
          "filipino",
          "mexican",
        ]) {
          await classify(`I love ${group} food`);
        }
      });
    </script>
  </body>
</html>
